name: "Copilot Setup Steps"

# Automatically run the setup steps when they are changed to allow for easy validation, and
# allow manual testing through the repository's "Actions" tab
on:
    workflow_dispatch:
    push:
        paths:
            - .github/workflows/copilot-setup-steps.yml
    pull_request:
        paths:
            - .github/workflows/copilot-setup-steps.yml

jobs:
    # The job MUST be called `copilot-setup-steps` or it will not be picked up by Copilot.
    copilot-setup-steps:
        runs-on: ubuntu-latest

        # Set the permissions to the lowest permissions possible needed for your steps.
        # Copilot will be given its own token for its operations.
        permissions:
            contents: read

        steps:
            - name: Checkout code
              uses: actions/checkout@v6

            - name: Set up Python 3.13
              uses: actions/setup-python@v6
              with:
                  python-version: "3.13"
                  cache: "pip"
                  cache-dependency-path: |
                      pyproject.toml

            - name: Upgrade pip tooling
              run: |
                  python -m pip install --upgrade pip setuptools wheel

            # Preinstall runtime + dev tooling so the agent can immediately run ruff/pyright/pytest later.
            # (Checks themselves are intentionally NOT run here.)
            - name: Install dependencies (editable + dev)
              run: |
                  python -m pip install -e ".[dev]"